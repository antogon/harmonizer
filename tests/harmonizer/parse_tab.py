import pytest
from harmonizer import parse_tablature

more_mess_theme_lick = '''
e|-----------------|-----------------|-----------------|-----------------|
B|-----------------|-----------------|-----------------|-----------------|
G|-----------------|---------5-5-7---|-----------------|-----------------|
D|-------------5-5-|-5-7-7-7---------|-----------------|-----------------|
A|-5-5-5-8-8-8-----|-----------------|-----------------|-----------------|
E|-----------------|-----------------|-----------------|-----------------|
'''

invalid_tablature = '''
e|-----------------|-----------------|-----------------|-----------------|
B|-----------------|-----------------|-----------------|-----------------|
|-----------------|---------5-5-7---|-----------------|-----------------|
D|-------------5-5-|-5-7-7-7---------|-----------------|-----------------|
A|-5-5-5-8-8-8-----|-----------------|-----------------|-----------------|E|-----------------|-----------------|-----------------|-----------------|
'''

def test_raises_on_invalid_input():
    with pytest.raises(RuntimeError):
        parse_tablature(invalid_tablature)

def test_parse_tablature_happy_path():
    pitches = parse_tablature(more_mess_theme_lick)
    assert list(map(lambda pitch: pitch.name, pitches)) == \
        ['D', 'D', 'D', 'F', 'F', 'F', 'G', 'G', 'G', 'A', 'A', 'A', 'C', 'C', 'D']